{% extends 'adopcion/base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-body p-4">
                    <h2 class="text-center mb-4">Publicar Mascota en Adopción</h2>
                    
                    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        {% if form.errors %}
                        <div class="alert alert-danger">
                            Por favor corrige los errores en el formulario.
                        </div>
                        {% endif %}

                        <div class="row g-4">
                            <!-- Nombre -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    {{ form.nombre }}
                                    <label for="{{ form.nombre.id_for_label }}">Nombre de la Mascota</label>
                                </div>
                                {% if form.nombre.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.nombre.errors.0 }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Tipo -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    {{ form.tipo }}
                                    <label for="{{ form.tipo.id_for_label }}">Tipo de Mascota</label>
                                </div>
                                {% if form.tipo.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.tipo.errors.0 }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Raza -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    {{ form.raza }}
                                    <label for="{{ form.raza.id_for_label }}">Raza (opcional)</label>
                                </div>
                                {% if form.raza.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.raza.errors.0 }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Edad -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    {{ form.edad }}
                                    <label for="{{ form.edad.id_for_label }}">Edad Aproximada</label>
                                </div>
                                {% if form.edad.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.edad.errors.0 }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Sexo -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    {{ form.sexo }}
                                    <label for="{{ form.sexo.id_for_label }}">Sexo</label>
                                </div>
                                {% if form.sexo.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.sexo.errors.0 }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Tamaño -->
                            <div class="col-md-6">
                                <div class="form-floating">
                                    {{ form.tamanio }}
                                    <label for="{{ form.tamanio.id_for_label }}">Tamaño</label>
                                </div>
                                {% if form.tamanio.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.tamanio.errors.0 }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- Foto -->
                            <div class="col-12">
                                <div class="image-upload-container mb-3">
                                    <label for="{{ form.foto.id_for_label }}" class="form-label">
                                        Foto de la Mascota
                                        {% if form.foto.help_text %}
                                        <small class="text-muted d-block">{{ form.foto.help_text }}</small>
                                        {% endif %}
                                    </label>
                                    <div class="custom-file-upload">
                                        {{ form.foto }}
                                        <div id="preview-container" class="mt-3 d-none">
                                            <img id="preview-image" src="#" alt="Vista previa" class="img-fluid rounded">
                                        </div>
                                    </div>
                                    {% if form.foto.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.foto.errors.0 }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Descripción -->
                            <div class="col-12">
                                <div class="form-floating">
                                    {{ form.descripcion }}
                                    <label for="{{ form.descripcion.id_for_label }}">Descripción</label>
                                </div>
                                {% if form.descripcion.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.descripcion.errors.0 }}
                                </div>
                                {% endif %}
                            </div>

                            <div class="col-12">
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-paw me-2"></i>Publicar Mascota
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-floating {
        margin-bottom: 1rem;
    }

    .form-floating > label {
        padding: 1rem;
    }

    .form-floating > .form-control {
        padding: 1rem;
        height: calc(3.5rem + 2px);
        line-height: 1.25;
    }

    .form-floating > textarea.form-control {
        height: auto;
        min-height: 100px;
    }

    .custom-file-upload {
        border: 2px dashed var(--turquoise-light);
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .custom-file-upload:hover {
        border-color: var(--turquoise);
        background-color: var(--turquoise-light);
    }

    #preview-image {
        max-height: 200px;
        object-fit: cover;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--turquoise), var(--lilac));
        border: none;
        padding: 1rem 2rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(64, 224, 208, 0.3);
    }

    .card {
        border: none;
        border-radius: 15px;
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fileInput = document.querySelector('input[type="file"]');
        const previewContainer = document.getElementById('preview-container');
        const previewImage = document.getElementById('preview-image');

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewContainer.classList.remove('d-none');
                }
                reader.readAsDataURL(file);
            } else {
                previewContainer.classList.add('d-none');
                previewImage.src = '#';
            }
        });

        // Make the entire custom-file-upload div clickable
        document.querySelector('.custom-file-upload').addEventListener('click', function() {
            fileInput.click();
        });
    });
</script>
{% endblock %}
