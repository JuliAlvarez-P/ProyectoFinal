{% extends 'adopcion/base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-5" style="color: var(--lilac); text-shadow: 2px 2px 4px rgba(var(--lilac-rgb), 0.1);">
        <i class="fas fa-paw me-2" style="color: var(--lilac);"></i>
        Mascotas Disponibles para Adopción
    </h2>
    
    {% if mascotas %}
    <div class="row">
        {% for mascota in mascotas %}
        <div class="col-md-4 mb-4">
            <div class="card h-100" style="border: 2px solid rgba(var(--lilac-rgb), 0.1); transition: all 0.3s ease;">
                {% if mascota.imagen %}
                    <img src="{{ mascota.imagen.url }}" class="card-img-top" alt="{{ mascota.nombre }}" style="height: 250px; object-fit: cover;">
                {% else %}
                    <img src="https://images.unsplash.com/photo-1543466835-00a7907e9de1?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" class="card-img-top" alt="{{ mascota.nombre }}" style="height: 250px; object-fit: cover;">
                {% endif %}
                <div class="card-body" style="background: linear-gradient(135deg, white, rgba(var(--lilac-rgb), 0.05));">
                    <h5 class="card-title" style="color: var(--turquoise); border-bottom: 2px solid var(--lilac); display: inline-block; padding-bottom: 5px;">{{ mascota.nombre }}</h5>
                    <p class="card-text">{{ mascota.descripcion|truncatewords:20 }}</p>
                    <p class="card-text">
                        <small class="text-muted">
                            <i class="fas fa-birthday-cake me-2" style="color: var(--lilac);"></i>
                            Edad: {{ mascota.edad }} {{ mascota.unidad_edad }}
                        </small>
                    </p>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary" style="color: var(--lilac); border-color: var(--lilac); transition: all 0.3s ease;" data-bs-toggle="modal" data-bs-target="#mascotaModal{{ mascota.id }}">
                            <i class="fas fa-heart me-2"></i>Conocer más
                        </button>
                        {% if es_admin %}
                        <a href="{% url 'edit_mascota' mascota.id %}" class="btn btn-outline-secondary" style="transition: all 0.3s ease;">
                            <i class="fas fa-edit me-2"></i>Editar
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for {{ mascota.nombre }} -->
        <div class="modal fade" id="mascotaModal{{ mascota.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header" style="background: linear-gradient(135deg, var(--turquoise), var(--lilac)); color: white;">
                        <h5 class="modal-title">
                            <i class="fas fa-paw me-2"></i>{{ mascota.nombre }}
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-0">
                        <div class="row g-0">
                            <div class="col-md-7">
                                <!-- Image Carousel -->
                                <div id="carousel{{ mascota.id }}" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-inner">
                                        {% if mascota.imagenes.all %}
                                            {% for img in mascota.imagenes.all %}
                                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                                    <img src="{{ img.imagen.url }}" class="d-block w-100" alt="{{ mascota.nombre }}" style="height: 400px; object-fit: cover;">
                                                </div>
                                            {% endfor %}
                                        {% else %}
                                            <div class="carousel-item active">
                                                {% if mascota.imagen %}
                                                    <img src="{{ mascota.imagen.url }}" class="d-block w-100" alt="{{ mascota.nombre }}" style="height: 400px; object-fit: cover;">
                                                {% else %}
                                                    <img src="https://images.unsplash.com/photo-1543466835-00a7907e9de1?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" class="d-block w-100" alt="{{ mascota.nombre }}" style="height: 400px; object-fit: cover;">
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    {% if mascota.imagenes.all|length > 1 %}
                                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ mascota.id }}" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon"></span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ mascota.id }}" data-bs-slide="next">
                                        <span class="carousel-control-next-icon"></span>
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-5">
                                <div class="p-4">
                                    <div class="mb-3">
                                        <span class="badge" style="background: var(--turquoise);">{{ mascota.get_especie_display }}</span>
                                        <span class="badge ms-2" style="background: var(--lilac);">{{ mascota.get_estado_display }}</span>
                                    </div>
                                    <p class="text-muted mb-2">
                                        <i class="fas fa-birthday-cake me-2" style="color: var(--lilac);"></i>
                                        {{ mascota.edad }} {{ mascota.unidad_edad }}
                                    </p>
                                    <p class="mb-4" style="text-align: justify;">{{ mascota.descripcion }}</p>
                                    <button class="btn btn-primary w-100" style="background: linear-gradient(135deg, var(--turquoise), var(--lilac));">
                                        <i class="fas fa-heart me-2"></i>¡Quiero adoptar!
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center" style="background: rgba(var(--lilac-rgb), 0.05); padding: 3rem; border-radius: 15px;">
        <i class="fas fa-paw fa-4x mb-3" style="color: var(--lilac);"></i>
        <h3 style="color: var(--turquoise);">No hay mascotas disponibles en este momento</h3>
        <p class="lead" style="color: var(--lilac);">Vuelve pronto para ver nuevas mascotas en busca de un hogar.</p>
    </div>
    {% endif %}
</div>

<!-- Call to Action -->
<section class="py-5 mt-5" style="background: linear-gradient(135deg, var(--lilac), var(--turquoise));">
    <div class="container text-center text-white">
        <h2 class="mb-4" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">
            <i class="fas fa-search me-2"></i>
            ¿No encuentras lo que buscas?
        </h2>
        <p class="lead mb-4">Vuelve a visitarnos pronto. Nuevas mascotas están esperando un hogar cada día.</p>
        <a href="{% url 'inicio' %}" class="btn btn-light btn-lg" style="border: 2px solid var(--lilac); transition: all 0.3s ease;">
            <i class="fas fa-home me-2"></i>
            Volver al Inicio
        </a>
    </div>
</section>
{% endblock %}
